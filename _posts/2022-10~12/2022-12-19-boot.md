---
layout: post
title:  "Boot"
date:  2022-12-15
tags: [note]
---


# 16 位 CPU 寻址 1MB 内存

  参考 [Real-Mode Memory Management](https://kajouni.net/info/eng/realmode.htm)，在 Intel 处理器的 real-mode（中文翻译可能叫「实模式」）中，实际的物理地址是通过 segment + offset 的形式来确认的。

  其中 segment register 有以下：


<table>
  <thead>
    <tr>
      <th>
         Segment Register
      </th>
      <th>
          Designated Role
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
          <center>CS</center>
      </td>
      <td>
          <b>Code Segment Register</b>
          <br />
          This register points to the currently active code segment. Used in
          conjunction with the IP register to point to the next instruction to
          be fetched and executed by the processor.
      </td>
    </tr>
    <tr>
      <td>
          <center>DS</center>
      </td>
      <td>
          <b>Data Segment Register</b>
          <br />
          This register usually points to the default data segment which
          contains the global and static variables of the active application.
      </td>
    </tr>
    <tr>
      <td>
          <center>ES</center>
      </td>
      <td>
          <b>Extra Segment Register</b>
          <br />
          General purpose segment register used mostly for data transfers
          between different segments.
      </td>
    </tr>
    <tr>
      <td>
          <center>SS</center>
      </td>
      <td>
          <b>Stack Segment Register</b>
          <br />
          This register points to the segment containing the active stack. The
          top of stack is located at address SS:SP.
      </td>
    </tr>
    <tr>
      <td>
          <center>
            FS
            <br />
            GS
          </center>
      </td>
      <td>
          <b>General Purpose Segment Registers</b>
          <br />
          First introduced on the 80386, these segment registers can be used for
          any purpose in your application code.
      </td>
    </tr>
  </tbody>
</table>

  计算方式如下：

![image](https://user-images.githubusercontent.com/7157346/209896897-6f9b8347-59d5-4283-8c87-c8ead084ba7f.png)

  比如，如果想访问地址 `0x12345`，可以使用以下汇编实现 `[0x1234:0x5]` ( segment 0x1234 + offset 0x5)：

```asm
Mov BX, 1234h
Mov ES, BX
Mov BX, 5h
Mov AL, [ES:BX]
```

  因为 segment 和 offset 是有部分重叠的，所以 `0x12345` 也能通过 `[0x1233:0x15]`( segment 0x1233 + offset 0x15) 来访问。


# References
* [Real-Mode Memory Management](https://kajouni.net/info/eng/realmode.htm)
* [你管这破玩意叫操作系统源码 | 第一回 最开始的两行代码](https://mp.weixin.qq.com/s/LIsqRX51W7d_yw-HN-s2DA)
* [全网最硬核讲解计算机的启动过程](https://mp.weixin.qq.com/s?__biz=Mzk0MjE3NDE0Ng==&mid=2247483867&idx=1&sn=76ece31324d32922a7cb9db129decd3f)
