---
layout: post
title:  "关于前端项目如何做开放&扩展的几点思路与实现方式"
date:  2024-09-12
tags: [framework]
---

  关于如何做好业务代码开放、扩展的技术架构设计和相关想法。接上次
* [如何做扩展](https://zhoukekestar.github.io/notes/2024/08/06/extend.html)
* [如何做扩展（2）](https://zhoukekestar.github.io/notes/2024/09/11/extend2.html)

摘要：

关键词：开放、扩展、灵活性、定制

# 背景

  关于如何做好业务代码的开放，及其扩展的实现。随着业务的快速发展，不同业务技术团队对基础代码提出了更高的诉求，包括：如何做部分 UI 的定制、如何快速添加特定场景的功能、如何修改部分已有逻辑等等。

  如果没有好的技术架构来支撑扩展，那么将会导致巨大的技术咨询、重复开发，也会因为没有好的隔离、抽象，导致整体的可维护性急剧下降，甚至导致线上稳定性的问题，致使业务不可用。

  故本文对业务场景的项目代码，简单探讨对开放&扩展的几点思路，并尝试实践了一种笔者个人觉得较为适合当下场景的实现。

# 架构模式

  业务场景的开发&扩展问题，可以很自然就联想到[架构模式](https://en.wikipedia.org/wiki/Architectural_pattern)上，而且业界对此也有着非常多的研究。比如较为著名的 Gang of Four (GoF) 的[设计模式](https://en.wikipedia.org/wiki/Design_Patterns)。

  从软件的开放、扩展的角度看，能比较贴合场景对开放&扩展诉求的设计模式有：

* [观察者模式](https://en.wikipedia.org/wiki/Observer_pattern)
* [复合模式](https://en.wikipedia.org/wiki/Composite_pattern)
* [桥接模式](https://en.wikipedia.org/wiki/Bridge_pattern)
* [拦截器模式](https://en.wikipedia.org/wiki/Interceptor_pattern)

## 观察者模式

  观察者模式，又称发布-订阅模式。

  ![image](https://github.com/user-attachments/assets/b6659c84-d928-4477-adc9-438428a70633)

  观察者对目标的状态变化进行监听（attach），当目标的状态变化时（setState），触发自身的 通知函数（notify），并逐一通知观察者对象（update），观察者视情况获取最新的状态（getState）

  将观察者模式应用到开发&扩展架构中，是相当常见的一种思路。比如 Eclipse 插件的开发：

  ![](https://github.com/user-attachments/assets/c2c92d82-1c35-40a1-ab25-17ce640b3813)

  Eclipse 的插件架构，提供了统一的「选中服务」（Selection Service），并对相关事件的发布者、订阅者做统一的管理，在观察者模式的基础上，有点 「消息总线」 的味道。

  相关的选中事件，提供方可能有「代码选中」、「包路径选中」、「大纲树选中」等，观察者对象可以监听这些事件，并做相关处理，比如「属性面板」对上述发布者做相关监听，并分别显示 「代码」、「包」、「函数」等不同选中对象的相关属性。


## 复合模式




# 前端开放&扩展技术架构

  从上文总结的整体诉求，可以从以下几个方面来做技术架构设计：

* 【接入】成本低，少改造、少侵入
  * 做到对原有程序的改造最小化；
  * 引入 Meta Programming（元编程）技术，对现有程序做相关声明，通过反射等技术，来实现相关扩展；
* 【主体】扩展性高，方便灵活
  * 能对包括任意函数、类、接口等做相关扩展；
  * 对不符合扩展要求的，做独立函数的抽离，便能对相关逻辑主体做扩展；
* 【客体】开放性高，干预能力强
  * 能拦截、干预、替换、扩展、重写、重载等，做到对主体逻辑的强有力干预；
  * 能做多重干预，多层业务的定制化诉求；

# Eclipse

| UI 扩展 | 函数扩展 | 事件扩展 |
| ---- | ---- | ------- |
| ![](https://www.eclipse.org/articles/Article-Plug-in-architecture/images/eclipse_extensions.jpg) | ![](https://www.eclipse.org/articles/Article-Plug-in-architecture/images/services_extensions.jpg)    | ![](https://www.eclipse.org/articles/Article-Plug-in-architecture/images/listeners_extensions.jpg)  |


# 参考

1. [Architectural Pattern](https://en.wikipedia.org/wiki/Architectural_pattern)
2. [Eclipse Plug-in architecture](https://www.eclipse.org/articles/Article-Plug-in-architecture/plugin_architecture.html)
