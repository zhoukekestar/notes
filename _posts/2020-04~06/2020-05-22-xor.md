---
layout: post
title:  "ç¥ç»ç½‘ç»œ XOR JS å®ç°"
date:  2020-05-22
tags: [AI, js]
commentIssueId: 110
---




## ç®€è¦

å‰ç«¯ç¥ç»ç½‘ç»œåˆå­¦è€…ï¼Œæ£é¼“ XOR é€»è¾‘è¿ç®—ï¼Œä¹‹å‰è‡ªå·±å¾ˆå¤šæ—¶å€™ï¼Œéƒ½åœ¨çœ‹æ–‡ç« æˆ–åœ¨åšå¾ˆæµ®äºè¡¨é¢çš„ Demoï¼Œæ²¡æœ‰å¾ˆç»†èŠ‚åœ°å®è·µè¿‡è¿™ä¹ˆåº•å±‚çš„é€»è¾‘å’Œç›¸å…³æ€è€ƒï¼Œå‹¿å–·~



## èƒŒæ™¯

æ¥è‡ª @å¤•å±± å¤§ä½¬çš„çµæ„Ÿï¼Œçœ‹åˆ° [ã€Šç¥ç»ç½‘ç»œçš„æ¼”è¿›å²ã€‹](https://yuque.alibaba-inc.com/nil.wyw/algo/nengil) ä»¥åŠå¯¹é€»è¾‘è¿ç®—çš„è®­ç»ƒè¿‡ç¨‹ï¼Œ[ç¥ç»ç½‘ç»œçš„ç¨‹åºå…¥é—¨ï¼ˆJs ç‰ˆï¼‰](https://yuque.alibaba-inc.com/nil.wyw/algo/pvonyn) ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
var log = console.log;

var Perceptron = function() { // æ„ŸçŸ¥å™¨
  this.step=function(x, w) { // æ­¥é˜¶å‡½æ•°ï¼šè®¡ç®—ç›®å‰æƒé‡ w çš„æƒ…å†µä¸‹ï¼Œç½‘è·¯çš„è¾“å‡ºå€¼ä¸º 0 æˆ– 1
    var result = w[0]*x[0]+w[1]*x[1]+w[2]*x[2]; // y=w0*x0+x1*w1+x2*w2=-theta+x1*w1+x2*w2
    if (result >= 0) // å¦‚æœç»“æœå¤§äºé›¶
      return 1;      //   å°±è¾“å‡º 1
    else             // å¦åˆ™
      return 0;      //   å°±è¾“å‡º 0
  }
  
  this.training=function(truthTable) { // è®­ç»ƒå‡½æ•° training(truthTable), å…¶ä¸­ truthTable æ˜¯ç›®æ ‡çœŸå€¼è¡¨
    var rate = 0.01; // å­¦ä¹ è°ƒæ•´é€Ÿç‡ï¼Œä¹Ÿå°±æ˜¯ alpha
    var w = [ 1, 0, 0 ]; 
    for (var loop=0; loop<1000; loop++) { // æœ€å¤šè®­ç»ƒä¸€åƒè½®
      var eSum = 0.0;
      for (var i=0; i<truthTable.length; i++) { // æ¯è½®å¯¹äºçœŸå€¼è¡¨ä¸­çš„æ¯ä¸ªè¾“å…¥è¾“å‡ºé…å¯¹ï¼Œéƒ½è®­ç»ƒä¸€æ¬¡ã€‚
        var x = [ -1, truthTable[i][0], truthTable[i][1] ]; // è¾“å…¥ï¼š x
        var yd = truthTable[i][2];       // æœŸæœ›çš„è¾“å‡º yd
        var y = this.step(x, w);  // ç›®å‰çš„è¾“å‡º y
        var e = yd - y;                  // å·®è· e = æœŸæœ›çš„è¾“å‡º yd - ç›®å‰çš„è¾“å‡º y
        eSum += e*e;                     // è®¡ç®—å·®è·æ€»å’Œ
        var dw = [ 0, 0, 0 ];            // æƒé‡è°ƒæ•´çš„å¹…åº¦ dw
        dw[0] = rate * x[0] * e; w[0] += dw[0]; // w[0] çš„è°ƒæ•´å¹…åº¦ä¸º dw[0]
        dw[1] = rate * x[1] * e; w[1] += dw[1]; // w[1] çš„è°ƒæ•´å¹…åº¦ä¸º dw[1]
        dw[2] = rate * x[2] * e; w[2] += dw[2]; // w[2] çš„è°ƒæ•´å¹…åº¦ä¸º dw[2]
        if (loop % 100 == 0)
          log("%d:x=(%s,%s,%s) w=(%s,%s,%s) y=%s yd=%s e=%s", loop, 
               x[0].toFixed(3), x[1].toFixed(3), x[2].toFixed(3), 
               w[0].toFixed(3), w[1].toFixed(3), w[2].toFixed(3), 
               y.toFixed(3), yd.toFixed(3), e.toFixed(3));
      }
      if (Math.abs(eSum) < 0.0001) return w; // å½“è®­ç»ƒç»“æœè¯¯å·®å¤Ÿå°æ—¶ï¼Œå°±å®Œæˆè®­ç»ƒäº†ã€‚
    }
    return null; // å¦åˆ™ï¼Œå°±ä¼ ä¼š null ä»£è¡¨è®­ç»ƒå¤±è´¥ã€‚
  }
}

function learn(tableName, truthTable) { // å­¦ä¹ ä¸»ç¨‹å¼ï¼šè¾“å…¥ä¸ºç›®æ ‡çœŸå€¼è¡¨ truthTable ä¸å…¶åç§° tableNameã€‚
  log("================== å­¦ä¹  %s å‡½æ•° ====================", tableName);
  var p = new Perceptron();       // å»ºç«‹æ„ŸçŸ¥å™¨ç‰©ä»¶
  var w = p.training(truthTable); // è®­ç»ƒæ„ŸçŸ¥å™¨
  if (w != null)                  // æ˜¾ç¤ºè®­ç»ƒç»“æœ
    log("å­¦ä¹ æˆåŠŸ !");
  else
    log("å­¦ä¹ å¤±è´¥ !");
  log("w=%j", w);
}

var andTable = [ [ 0, 0, 0 ], [ 0, 1, 0 ], [ 1, 0, 0 ], [ 1, 1, 1 ] ]; // AND å‡½æ•°çš„çœŸå€¼è¡¨
var orTable  = [ [ 0, 0, 0 ], [ 0, 1, 1 ], [ 1, 0, 1 ], [ 1, 1, 1 ] ]; // OR  å‡½æ•°çš„çœŸå€¼è¡¨
var xorTable = [ [ 0, 0, 0 ], [ 0, 1, 1 ], [ 1, 0, 1 ], [ 1, 1, 0 ] ]; // XOR å‡½æ•°çš„çœŸå€¼è¡¨

learn("and", andTable); // å­¦ä¹  AND å‡½æ•°
learn("or",  orTable);  // å­¦ä¹  OR  å‡½æ•°
learn("xor", xorTable); // å­¦ä¹  XOR å‡½æ•°
```



èƒŒåæ±‚å‡ºçš„ weight å…¶å®å°±æ˜¯å¯¹ä¸Šè¿°çœŸå€¼è¡¨çš„çº¿æ€§åˆ’åˆ†ï¼ˆç›—å›¾è‡ª @å¤•å±± å¤§ä½¬ ğŸ˜‚ï¼‰ï¼š

![](https://img.alicdn.com/tfs/TB1v05hHeL2gK0jSZFmXXc7iXXa-1436-437.png)



ä»¥ä¸Šçš„å•å±‚æ„ŸçŸ¥å™¨ï¼Œèƒ½æˆåŠŸå­¦ä¹  AND å’Œ OR å‡½æ•°ï¼Œä½†æ˜¯ XOR å°±å¾ˆæ— èƒ½ä¸ºåŠ›ï¼Œçœ‹åˆ°è¿™é‡Œï¼Œè§‰å¾—å¾ˆæ„çŠ¹æœªå°½ã€‚

å› ä¸ºä¹‹å‰ä¹Ÿæ£é¼“è¿‡ DeepLearning çš„ [æ‰‹å†™è¯†åˆ«](https://zhoukekestar.github.io/notes/2019/07/21/deep-learning-demo.html) ç›¸å…³çš„ Demoï¼Œæ‰€ä»¥æƒ³å†³å®šåŠ ä¸ªéšè—å±‚æ¥å®ç° xor æ“ä½œï¼Œä»ç†è®ºä¸Šè®²ï¼ŒåŠ ä¸€å±‚éšè— Layer ä¹‹åï¼Œå°†åŸæœ‰ XOR çŸ©é˜µåšä¸€æ¬¡è½¬æ¢æ˜ å°„ä¹‹åï¼Œä¾¿èƒ½åšè¿›ä¸€æ­¥çš„çº¿æ€§åˆ’åˆ†äº†ã€‚ç±»ä¼¼ä»¥ä¸‹ï¼š



![](https://img.alicdn.com/tfs/TB1P7mdHXY7gK0jSZKzXXaikpXa-1006-458.png)



æˆ‘ä»¬é€šè¿‡åŠ ä¸€å±‚ 2 ç»´ç©ºé—´éšè—å±‚ï¼Œå°† XOR æ˜ å°„ä¸ºä¸Šå›¾ä¸­çš„ç¬¬äºŒä¸ªçœŸå€¼è¡¨ï¼Œäºæ˜¯æˆ‘ä»¬å°±èƒ½æ„‰å¿«åœ°åˆ†å‰²äº† ğŸ˜‚



## XOR è®­ç»ƒ JS ä»£ç 

```javascript

var log = console.log;
var random = () => {
  return +(Math.random() * 2 - 1).toFixed(4);
};

class Perceptron {

  constructor({ truthTable, tableName, w1, w2 }) {

    this.tableName = tableName;
    this.rate = 0.001;
    this.loopTimes = 1000000;

    this.w1 = w1 || [[ random(), random(), random()], [random(), random(), random()]]
    this.w2 = w2 || [ random(), random(), random() ];
    this.truthTable = truthTable;
  }

  // ç”¨äºæ ¡éªŒç»“æœ
  verify(showlog) {
    const { truthTable, tableName, w1, w2 } = this;

    for (var i=0; i<truthTable.length; i++) {
      var x1 = [ truthTable[i][0], truthTable[i][1], 1 ];
      var x2 = [ this.step(x1, w1[0]), this.step(x1, w1[1]), 1];
      var y = this.step(x2, w2);

      if (showlog) {
        console.log(truthTable[i][0] + ' ' + tableName + ' ' + truthTable[i][1] + ' = ', y, '(', x1, ',', x2, ')' );
      }

      if (y !== truthTable[i][2]) return false;
    }

    return true;
  }

  step(x, w) {
    // æ­£å‘æ±‚å’Œ
    var result = w[0]*x[0]+w[1]*x[1]+w[2]*x[2];

    // æ¿€æ´»å‡½æ•°
    if (result >= 0) return 1;
    else return 0;
  }

  training() { // è®­ç»ƒå‡½æ•° training(truthTable), å…¶ä¸­ truthTable æ˜¯ç›®æ ‡çœŸå€¼è¡¨
    const { rate, w1, w2, truthTable, loopTimes } = this;

    for (var loop=0; loop < loopTimes; loop++) { // è®­ç»ƒæ¬¡æ•°
      var e = 0;

      // æ¯è½®å¯¹äºçœŸå€¼è¡¨ä¸­çš„æ¯ä¸ªè¾“å…¥è¾“å‡ºé…å¯¹ï¼Œéƒ½è®­ç»ƒä¸€æ¬¡ã€‚
      for (var i=0; i < truthTable.length; i++) {

        // ä¸€å±‚è¾“å…¥å€¼ + basis
        var x1 = [ truthTable[i][0], truthTable[i][1], 1 ];

        // æœŸæœ›å€¼
        var yd = truthTable[i][2];

        // éšè—å±‚
        var x2 = [ this.step(x1, w1[0]), this.step(x1, w1[1]), 1];

        // è¾“å‡ºç»“æœå±‚
        var y = this.step(x2, w2);

        // é¢„æœŸå·®å€¼
        e = yd - y;

        // åå‘ä¼ æ’­ç¬¬ä¸€å±‚
        // è¿™é‡Œçš„é“¾å¼æ±‚å¯¼ï¼Œè¿˜æ˜¯æ¨¡ç³Šçš„çŠ¶æ€ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™ç§å½¢å¼ï¼Ÿ
        w2[0] += rate * x2[0] * e;
        w2[1] += rate * x2[1] * e;
        w2[2] += rate * x2[2] * e;


        // åå‘ä¼ æ’­ç¬¬äºŒå±‚
        w1[0][0] += rate * x1[0] * e * w2[0];
        w1[0][1] += rate * x1[0] * e * w2[1];
        w1[0][2] += rate * x1[0] * e * w2[2];

        w1[1][0] += rate * x1[1] * e * w2[0];
        w1[1][1] += rate * x1[1] * e * w2[1];
        w1[1][2] += rate * x1[1] * e * w2[2];
      }

      // æ ¡éªŒé€šè¿‡ï¼Œåˆ™åœæ­¢è®­ç»ƒ
      if (this.verify()) {
        return {
          loop, w1, w2
        };
      }
    }

    // è®­ç»ƒå¤±è´¥
    return null;
  }
}

function learn(tableName, truthTable, w1, w2) {

  // å»ºç«‹æ„ŸçŸ¥å™¨ç‰©ä»¶
  var p = new Perceptron({
    truthTable,
    tableName,
    w1,
    w2,
  });

  var result = p.training(); // å¼€å§‹è®­ç»ƒ
  if (result != null) {
    log(" å­¦ä¹  %s å‡½æ•°æˆåŠŸï¼š", tableName);
    log("loop=", result.loop, ' w1: ', JSON.stringify(result.w1), ' w2: ', JSON.stringify(result.w2));
    p.verify(true);
  } else {
    log(" å­¦ä¹  %s å‡½æ•°å¤±è´¥", tableName);
  }
}

var andTable = [ [ 0, 0, 0 ], [ 0, 1, 0 ], [ 1, 0, 0 ], [ 1, 1, 1 ] ]; // AND å‡½æ•°çš„çœŸå€¼è¡¨
var orTable  = [ [ 0, 0, 0 ], [ 0, 1, 1 ], [ 1, 0, 1 ], [ 1, 1, 1 ] ]; // OR  å‡½æ•°çš„çœŸå€¼è¡¨
var xorTable = [ [ 0, 0, 0 ], [ 0, 1, 1 ], [ 1, 0, 1 ], [ 1, 1, 0 ] ]; // XOR å‡½æ•°çš„çœŸå€¼è¡¨


// å› ä¸ºå¤±è´¥æ¦‚è§ˆè¾ƒé«˜ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°è¯•å¤šæ¬¡å­¦ä¹ 
for (var i = 0; i< 10; i++) {
  console.log(`======== ç¬¬ ${i} æ¬¡å­¦ä¹  ========`)

  // é€šè¿‡é¢„è®­ç»ƒï¼Œè¾“å…¥åˆå§‹çŠ¶æ€ï¼ŒåŠ å¿«è®­ç»ƒ
  // learn("and", andTable, [[0.5, 0, 0], [0, 0, 0]], [0.5, 0, -0.5]);
  learn("and",  andTable);
  learn("or",  orTable);
  learn("xor", xorTable);

  console.log('\n')
}

```

ç»“æœè¾“å‡ºï¼š

```
======== ç¬¬ 5 æ¬¡å­¦ä¹  ========
 å­¦ä¹  and å‡½æ•°æˆåŠŸï¼š
loop= 341730  w1:  [[0.39963790000397476,33.63402299979549,-0.9887426000058843],[-0.20303059999641215,0.41553599999999374,-0.41543859999487487]]  w2:  [0.0009000000000003372,-0.0010000000000000763,-0.0005999999999999929]
0 and 0 =  0 ( [ 0, 0, 1 ] , [ 0, 0, 1 ] )
0 and 1 =  0 ( [ 0, 1, 1 ] , [ 1, 1, 1 ] )
1 and 0 =  0 ( [ 1, 0, 1 ] , [ 0, 0, 1 ] )
1 and 1 =  1 ( [ 1, 1, 1 ] , [ 1, 0, 1 ] )
 å­¦ä¹  or å‡½æ•°æˆåŠŸï¼š
loop= 244  w1:  [[0.5519268,-0.06474380000000002,-0.06840439999999995],[-0.49513199999999985,-1.0470319999999997,0.558002]]  w2:  [0.39760000000000023,-0.5260999999999998,0.13020000000000032]
0 or 0 =  0 ( [ 0, 0, 1 ] , [ 0, 1, 1 ] )
0 or 1 =  1 ( [ 0, 1, 1 ] , [ 0, 0, 1 ] )
1 or 0 =  1 ( [ 1, 0, 1 ] , [ 1, 1, 1 ] )
1 or 1 =  1 ( [ 1, 1, 1 ] , [ 1, 0, 1 ] )
 å­¦ä¹  xor å‡½æ•°æˆåŠŸï¼š
loop= 696460  w1:  [[-0.7513457000000062,0.35677259999999433,0.39457490000601025],[-36.21090990031919,35.48711019926247,-0.06928969999966195]]  w2:  [-0.000299999999999751,0.001400000000000198,0.00010000000000053716]
0 xor 0 =  0 ( [ 0, 0, 1 ] , [ 1, 0, 1 ] )
0 xor 1 =  1 ( [ 0, 1, 1 ] , [ 1, 1, 1 ] )
1 xor 0 =  1 ( [ 1, 0, 1 ] , [ 0, 0, 1 ] )
1 xor 1 =  0 ( [ 1, 1, 1 ] , [ 1, 0, 1 ] )

```



## ç»“è®º

ä¸ç¡®å®šåå‘ä¼ æ’­çš„é“¾å¼æ±‚å¯¼å¯¹äº†æ²¡ï¼ˆæŠ„@å¤•å±± å¤§ä½¬çš„å½¢å¼ç›´æ¥æ¨çš„ç¬¬äºŒå±‚ï¼‰ï¼Œä¸è¿‡ï¼Œå­¦ä¹ æ˜¯èƒ½æˆåŠŸï¼Œä¸è¿‡æœ‰ä¸€å®šæ¦‚ç‡ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ° xor çš„ç¬¬äºŒå±‚æ˜ å°„å±‚ï¼Œå°†ä¸€å±‚çš„è¾“å…¥æ‰“æ•£åï¼Œæˆ‘ä»¬ä¾¿èƒ½è½»æ¾çš„åˆ†å‰²~

å¸Œæœ›å€Ÿæ­¤æœ€ç®€å•çš„ç¥ç»ç½‘ç»œæ¥æ›´åŠ æ·±åˆ»åœ°ç†è§£èƒŒåçš„åŸç†å’Œæ¨å¯¼è¿‡ç¨‹ã€‚



## å‚è€ƒ

*  [ã€Šç¥ç»ç½‘ç»œçš„æ¼”è¿›å²ã€‹](https://yuque.alibaba-inc.com/nil.wyw/algo/nengil) 
* [ç¥ç»ç½‘ç»œçš„ç¨‹åºå…¥é—¨ï¼ˆJs ç‰ˆï¼‰](https://yuque.alibaba-inc.com/nil.wyw/algo/pvonyn) 
* [Deep Learning ä¹‹ Hello World Demo](https://zhoukekestar.github.io/notes/2019/07/21/deep-learning-demo.html) è‡ªå·±å†™çš„åœ¨çº¿è¯†åˆ«æ‰‹å†™æ•°å­—

* [â€œåå‘ä¼ æ’­ç®—æ³•â€è¿‡ç¨‹åŠå…¬å¼æ¨å¯¼](https://blog.csdn.net/ft_sunshine/article/details/90221691)
* [JS åŠ æ³•å™¨æ¨¡æ‹Ÿ](https://www.atatech.org/articles/107533) XOR å¦‚æ­¤é‡è¦çš„åŸå› 
* [JS åŠ æ³•å™¨æ¨¡æ‹Ÿ](https://zhoukekestar.github.io/notes/2018/05/08/js-adder.html) XOR å¦‚æ­¤é‡è¦çš„åŸå› 

